<!DOCTYPE html>
<!--    
    This file is part of OpenNotebook-Web

    OpenNotebook-Web is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    OpenNotebook-Web is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with OpenNotebook-Web.  If not, see <http://www.gnu.org/licenses/>. 
-->
<html>
<head>
<!-- http://paletton.com/#uid=13u0u0kllllaFw0g0qFqFg0w0aF --> 

<meta name="viewport" content="width=624">
<title>Open Notebook</title>

<link rel="stylesheet" type="text/css" href="../build/mathquill.css">
<link rel="stylesheet" type="text/css" href="support/home.css">
<!-- testing -->
<script src="https://npmcdn.com/expect/umd/expect.min.js"></script>

<!-- UI react-->
<script src="react/build/react.js"></script>
<script src="react/build/react-dom.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
<!-- input sanitiation --> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>

<!-- Only use this for MathQuill! --> 
<script type="text/javascript" src="support/jquery-1.7.2.js"></script>

<script type="text/javascript" src="../build/mathquill-basic.js"></script>
<!-- App state management -->
<script type="text/javascript" src="https://npmcdn.com/redux@3.5.2/dist/redux.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.12.0/lodash.js"></script>
<script type="text/babel">

// copied from here, didn't seem worth adding a dependency, I'm sure the JS people will cure me of that eventually...
// https://github.com/substack/deep-freeze/blob/master/index.js
function deepFreeze (o) {
  Object.freeze(o);

  Object.getOwnPropertyNames(o).forEach(function (prop) {
    if (o.hasOwnProperty(prop)
    && o[prop] !== null
    && (typeof o[prop] === "object" || typeof o[prop] === "function")
    && !Object.isFrozen(o[prop])) {
      deepFreeze(o[prop]);
    }
  });
  
  return o;
};

//Learning Redux

const UNTITLED_ASSINGMENT = 'Untitled Assignment';

// Application state properties
// TODO - use these as the actual keys in object literals in the reducer
// when I have ES6 and Babel

// Redux things
var type = 'type';

// Application modes
var APP_MODE = 'APP_MODE';
var EDIT_ASSIGNMENT = 'EDIT_ASSIGNMENT';
var GRADE_ASSIGNMENTS = 'GRADE_ASSIGNMENTS';

// Assignment properties
var ASSIGNMENT_NAME = 'ASSIGNMENT_NAME';
var PROBLEMS = 'PROBLEMS';

// Problem properties
var PROBLEM_NUMBER = 'PROBLEM_NUMBER';
var STEPS = 'STEPS';

// actions
var ADD_PROBLEM = 'ADD_PROBLEM';
var REMOVE_PROBLEM = 'REMOVE_PROBLEM';
var EDIT_STEP = 'EDIT_STEP';
// TODO - decide if I want to add a feature to splice in
// a new step partway through a current problem
var NEW_STEP = 'NEW_STEP';
var UNDO_STEP = 'UNDO_STEP';
var REDO_STEP = 'REDO_STEP';

function assignment(state, action) {
    if (state === undefined) {
        return {
            APP_MODE : EDIT_ASSIGNMENT,
            ASSIGNMENT_NAME : UNTITLED_ASSINGMENT,
            PROBLEMS : [ { PROBLEM_NUMBER : "1", STEPS : ["1+2", "3"] },
                         { PROBLEM_NUMBER : "2", STEPS : ["4-2", "2"] }
            ]
        }
    }
    
    if (action.type === ADD_PROBLEM) {
        var new_problems = _.clone(state[PROBLEMS]);
        new_problems.push({ PROBLEM_NUMBER : "", STEPS : [""] });
        var new_state = _.clone(state);
        new_state[PROBLEMS] = new_problems; 
        return new_state;
    } else if (action.type === NEW_STEP) {

    }
    return state;
}

var createStore = Redux.createStore;
var store = createStore(assignment);

function render() {
    console.log(document);
    ReactDOM.render(
        <OpenNotebook value={store.getState()} />,
        document.getElementById('root')
    );
}

var OpenNotebook = React.createClass({
  render: function() {
    console.log(this.props);
    // TODO - figure out how to best switch between teacher and
    // student mode rendering
    if (this.props.value[APP_MODE] === EDIT_ASSIGNMENT) {
        return (
            <div className="problem-container" style={{float:'none',overflow: 'hidden'}}>
                <div>Problem number <input type="text" className="problem-number"/></div>
                <br/>
                <div style={{float:'left'}}>
                    <p> Actions </p>
                    <input type="submit" className="next-step" name="next step" value="next step (ctrl-e)"/> <br/>
                    <input type="submit" className="undo-step" name="undo step" value="undo step (ctrl-z)"/> <br/>
                    <input type="submit" className="redo-step" name="redo step" value="redo step (ctrl-shift-z)"/>
                </div>
                    <div style={{float:'left'}} className="equation-list">
                    <p> Type math here </p>
                </div>
            </div>
        );
    }
  }
});

store.subscribe(render);
$(function() {
    render();
});

</script>
</head>
<body>
<div id="root"></div>
</body>
</html>
